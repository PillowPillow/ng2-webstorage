!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core")):"function"==typeof define&&define.amd?define(["exports","@angular/core"],t):t(e.ng2Webstorage=e.ng2Webstorage||{},e.ng.core)}(this,function(e,t){"use strict";function r(e,t){return function(t,r){o(e,c.local,t,r)}}function o(e,t,r,o){var n=e||o;Object.defineProperty(r,o,{get:function(){var e=h.genKey(n);return S.retrieve(t,e)},set:function(e){var r=h.genKey(n);this[r]=e,S.store(t,r,e)}})}function n(e){return function(t,r){o(e,c.local,t,r)}}function i(e){return function(t,r){o(e,c.session,t,r)}}function s(e){return new I(e)}function a(e){var t=void 0===e?{prefix:l,separator:f}:e,r=t.prefix,o=t.separator;console.warn("[ng2-webstorage:deprecation] The configure method is deprecated since the v1.5.0, consider to use forRoot instead"),h.setStorageKeyPrefix(r),h.setStorageKeySeparator(o)}var c;!function(e){e[e.local=0]="local",e[e.session=1]="session"}(c||(c={}));var u,l="ng2-webstorage",f="|",g=(u={},u[c.local]="local",u[c.session]="session",u),p=l,v=f,h=function(){function e(){}return e.isManagedKey=function(e){return 0===e.indexOf(p+v)},e.retrieveKeysFromStorage=function(e){return Object.keys(e).filter(function(e){return 0===e.indexOf(p)})},e.genKey=function(e){if("string"!=typeof e)throw Error("attempt to generate a storage key with a non string value");return""+p+v+e.toString().toLowerCase()},e.setStorageKeyPrefix=function(e){void 0===e&&(e=l),p=e},e.setStorageKeySeparator=function(e){void 0===e&&(e=f),v=e},e}(),d=function(){function e(){}return e.observe=function(e,r){var o=this.genObserverKey(e,r);return o in this.observers?this.observers[o]:this.observers[o]=new t.EventEmitter},e.emit=function(e,t,r){var o=this.genObserverKey(e,t);o in this.observers&&this.observers[o].emit(r)},e.genObserverKey=function(e,t){return e+"|"+t},e.observers={},e}(),y=function(){function e(){}return e.isSecuredField=function(t){return!!~e.securedFields.indexOf(t)},e.getStorage=function(t){return this.mockStorages[t]||(this.mockStorages[t]=e.generateStorage()),this.mockStorages[t]},e.generateStorage=function(){var t={};return Object.defineProperties(t,{setItem:{writable:!1,enumerable:!1,configurable:!1,value:function(t,r){e.isSecuredField(t)||(this[t]=r)}},getItem:{writable:!1,enumerable:!1,configurable:!1,value:function(t){return e.isSecuredField(t)?null:this[t]||null}},removeItem:{writable:!1,enumerable:!1,configurable:!1,value:function(t){e.isSecuredField(t)||delete this[t]}},length:{enumerable:!1,configurable:!1,get:function(){return Object.keys(this).length}}}),t},e.securedFields=["setItem","getItem","removeItem","length"],e.mockStorages={},e}(),S=function(){function e(){}return e.store=function(e,t,r){this.getStorage(e).setItem(t,JSON.stringify(r)),this.cached[e][t]=r,d.emit(e,t,r)},e.retrieve=function(t,r){return this.cached[t][r]?this.cached[t][r]:this.cached[t][r]=e.retrieveFromStorage(t,r)},e.retrieveFromStorage=function(e,t){var r=null;try{r=JSON.parse(this.getStorage(e).getItem(t))}catch(e){console.warn("invalid value for "+t)}return r},e.refresh=function(t,r){if(h.isManagedKey(r)){var o=e.retrieveFromStorage(t,r);null!=o&&o!==this.cached[t][r]&&(this.cached[t][r]=o,d.emit(t,r,o))}},e.clearAll=function(e){var t=this,r=this.getStorage(e);h.retrieveKeysFromStorage(r).forEach(function(o){r.removeItem(o),delete t.cached[e][o],d.emit(e,o,null)})},e.clear=function(e,t){this.getStorage(e).removeItem(t),delete this.cached[e][t],d.emit(e,t,null)},e.getStorage=function(e){return this.isStorageAvailable(e)?this.getWStorage(e):y.getStorage(e)},e.getWStorage=function(e){var t;switch(e){case c.local:t=localStorage;break;case c.session:t=sessionStorage;break;default:throw Error("invalid storage type")}return t},e.isStorageAvailable=function(e){if("boolean"==typeof this.storageAvailability[e])return this.storageAvailability[e];var t=!0,r=this.getWStorage(e);if("object"==typeof r)try{r.setItem("test-storage","foobar"),r.removeItem("test-storage")}catch(e){t=!1}else t=!1;return t||console.warn(g[e]+" storage unavailable, Ng2Webstorage will use a fallback strategy instead"),this.storageAvailability[e]=t},e.cached=(t={},t[c.local]={},t[c.session]={},t),e.storageAvailability=(r={},r[c.local]=null,r[c.session]=null,r),e;var t,r}(),b=function(){function e(e){void 0===e&&(e=null),this.sType=e,this.sType=e}return e.prototype.store=function(e,t){var r=h.genKey(e);S.store(this.sType,r,t)},e.prototype.retrieve=function(e){var t=h.genKey(e);return S.retrieve(this.sType,t)},e.prototype.clear=function(e){e?S.clear(this.sType,h.genKey(e)):S.clearAll(this.sType)},e.prototype.observe=function(e){var t=h.genKey(e);return d.observe(this.sType,t)},e}(),m=function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},w=function(e){function r(){e.call(this,c.local)}return m(r,e),r.decorators=[{type:t.Injectable}],r.ctorParameters=function(){return[]},r}(b),O=function(e,t){function r(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},K=function(e){function r(){e.call(this,c.session)}return O(r,e),r.decorators=[{type:t.Injectable}],r.ctorParameters=function(){return[]},r}(b),I=function(){function e(e){this.prefix=l,this.separator=f,e&&void 0!==e.prefix&&(this.prefix=e.prefix),e&&void 0!==e.separator&&(this.separator=e.separator)}return e}(),x=new t.OpaqueToken("WEBSTORAGE_CONFIG"),F=function(){function e(e,t){this.ngZone=e,t&&(h.setStorageKeyPrefix(t.prefix),h.setStorageKeySeparator(t.separator)),this.initStorageListener()}return e.forRoot=function(t){return{ngModule:e,providers:[{provide:x,useValue:t},{provide:I,useFactory:s,deps:[x]}]}},e.prototype.initStorageListener=function(){var e=this;window&&window.addEventListener("storage",function(t){return e.ngZone.run(function(){var e=window.sessionStorage===t.storageArea?c.session:c.local;S.refresh(e,t.key)})})},e.decorators=[{type:t.NgModule,args:[{declarations:[],providers:[K,w],imports:[]}]}],e.ctorParameters=function(){return[{type:t.NgZone},{type:I,decorators:[{type:t.Optional},{type:t.Inject,args:[I]}]}]},e}();e.WEBSTORAGE_CONFIG=x,e.Ng2Webstorage=F,e.provideConfig=s,e.configure=a,e.WebstorageConfig=I,e.LocalStorage=n,e.SessionStorage=i,e.WebStorage=r,e.WebStorageDecorator=o,e.WebStorageService=b,e.LocalStorageService=w,e.SessionStorageService=K,Object.defineProperty(e,"__esModule",{value:!0})});